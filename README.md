# HL7 仮想モニタシステム

## 現在の状態
- HL7 ORU^R01 メッセージの送信（`hl7_sender.py`）
- TCP/MLLP 受信（`hl7_receiver.py`）
- LOINC対応バイタル抽出（`hl7_parser.py`）
- OCR最優先の固定レイアウトGUI（`monitor.py`）

## monitor.py（OCR最優先GUI）

### 設計方針
- **文字サイズを最優先**（値は 44px の等幅フォント）
- 背景は白（`#FFFFFF`）、文字は黒（`#000000`）
- フォントは視認性の高いモノスペース（`DejaVu Sans Mono` / `Noto Sans Mono` / `Roboto Mono`）
- ラベルは小さめ（16px）、数値を主役化
- 1項目ごとに固定枠（カード）を使用し、値更新時も位置・幅が変化しない
- 数値は桁固定（ゼロ埋め）
  - HR: `000`
  - SpO2: `000`
  - RR: `00`
  - TEMP/BT/CO/CI: `00.0`
  - そのほかも項目ごとに固定桁
- 更新停止時は `NA` を固定幅で表示し、レイアウト崩れを防止

### レイアウト
- 解像度前提: `1920x1080` フルスクリーン
- ベッド: `BED01`〜`BED06` を縦配置
- 各ベッド: `4列 × 5行 = 20項目` の固定グリッド
- 各セル: 「ラベル（上段） + 値（下段）」の2段構成
- 全ベッドで同一セルサイズ（固定）

> 注: OCR精度優先のため、文字サイズを落として1画面に詰め込む設計は採用しません。

### データ更新
- `latest.json` を監視（ポーリング）
- JSON更新時は**値のみ**更新し、レイアウトは不変
- 一定時間（既定 15 秒）更新がなければ `NA` 表示

### 期待する `latest.json` 形式（例）
```json
{
  "BED01": {
    "HR": 78,
    "SpO2": 97,
    "RR": 18,
    "TEMP": 36.5
  },
  "BED02": {
    "HR": 65,
    "SpO2": 99,
    "RR": 14,
    "TEMP": 37.0,
    "timestamp": 1736500000
  }
}
```

### 起動方法
```bash
python monitor.py
```

## 今後実装したい機能
1. 仮想セントラルモニタ機能
   - 6ベッド分のHL7を生成
   - 各ベッド20種類程度のバイタル
   - 1分に1回送信
   - 数値はランダム（現実的な範囲）

2. データ集約機能
   - ベッド単位で最新データを保持
   - JSONキャッシュ出力

3. 独自モニタGUI
   - 6ベッド × 20項目の固定表示
   - 白背景・黒文字（OCR最適化）
   - 位置固定・桁固定
